# NULSIGHT 통합 룰 (Alpha 1.0.0)

이 문서는 사람이 읽기 쉽게 정리한 **룰 단일본**이다.  
미구현 항목도 삭제하지 않고 유지한다.

---

## 1. 게임 시작과 승리 조건

- 기본은 1:1 듀얼이다.
- 각 에이전트 시작 HP는 20이다.
- 게임 시작 시 각 에이전트는 손패 5장으로 시작한다.
- 상대 HP를 0 이하로 만들면 승리한다.
- 자신의 덱이 비어 있는데 드로우해야 하면 패배한다.

---

## 2. 덱과 드로우

- 덱은 30장 이상으로 구성한다.
- 게임 시작 시 덱을 셔플한다.
- 매 턴 드로우 페이즈에 턴 에이전트는 1장을 드로우한다.
- 현재 구현은 선공도 1턴 드로우를 수행한다.

---

## 3. 턴, 페이즈, 마나

### 3-1. 페이즈

- 페이즈 순서:
  - Phase 1 (드로우)
  - Phase 2 (메인)
  - Phase 3 (배틀)
  - Phase 4 (엔드)

### 3-2. 마나

- 카드를 사용할 때는 해당 마나를 지불해야 한다.
- 카드 세트는 없다.
- 자신의 턴 드로우 페이즈에:
  - 최대 마나 +2
  - 현재 마나 전부 리필
- 최대 마나는 12이다.
- 마나 표기는 `{N}` 형식을 사용한다.

### 3-3. 자동 효과 마나 규칙

- `<자동>` 효과는 필요한 마나가 있어야 발동된다.
- 보유 마나가 부족하면 해당 효과는 발동되지 않는다.

---

## 4. 카드 종류와 기본 처리

### 4-1. 유닛

- 스탯은 공격력/체력으로 구분한다.
- 체력은 누적 손상 상태로 유지된다.
- 다른 효과로 회복될 수 있다.

### 4-2. 마법

마법은 일반 마법, 지속 마법, 장착 마법으로 구분한다.

#### 일반 마법
- 필드에 놓을 때 코스트를 지불한다.
- 효과 사용 후 또는 자신의 엔드 페이즈에 무덤으로 간다.

#### 지속 마법
- 필드에 놓을 때 코스트를 지불한다.
- 효과 발동 마나는 별개로 지불한다.
- 필드에 존재할 때만 지속 효과가 유효하다.

#### 장착 마법
- 유닛을 지정해 부착한다.
- 장착 대상이 필드를 벗어나면 장착도 종료된다.
- 상세 처리 규칙은 추후 확장한다.

---

## 5. 효과 발동 기본 규칙

- 특별한 표기가 없으면 효과는 다음 제한을 따른다.
  - 자신의 턴에만 사용 가능
  - 1턴에 1번 사용 가능
- 효과 발동 조건은 `<>`로 표기한다.
  - 예: `<사용: {2} / 선택>`

---

## 6. 연쇄(Stack) / 우선권(Priority)

- 현재 엔진은 **MTG식 우선권 루프를 단순화한 스택 모델**을 사용한다.
- 스택 해결 순서는 LIFO(나중에 올라간 것이 먼저 해결)다.
- 스택이 비어 있지 않으면 일반 행동(카드 사용/공격/페이즈 진행)은 제한된다.
- 턴 플레이어와 상대가 `우선권 패스`를 연속으로 하면:
  - 스택이 있으면 top 1개 해결
  - 스택이 비어 있고 페이즈 진행 대기 상태면 다음 페이즈로 진행
- 효과 발동에 연쇄해 원본 카드를 제거해도, 별도 명시가 없으면 효과는 해결된다.

---

## 7. 카드 텍스트 작성 규칙

### 7-1. 작성 순서

1. `{N} 유닛 카드 - 공/체`
2. `종족 | 테마 | 속성`
3. `<일반 전개 불가>`
4. 전개 조건
5. `<전개 시: {N} / 선택 or 자동>`
6. 비용 지불형 효과 본문
7. `<사용: {N} / 선택 or 자동>`
8. 비용 지불형 효과 본문
9. `<유발 조건: {N} / 선택 or 자동>`
10. 비용 지불형 효과 본문
11. 지속 효과 본문
12. 플레이버 텍스트

### 7-2. 표기/문체

- 자동 효과: `<~ / 자동>`
- 선택 효과: `<~ / 선택>`
- 대상 지정 효과:
  - `필드의 카드/유닛/마법을 대상으로 한다. 그 카드를 ~~한다.`
- 플레이버 텍스트는 중앙 정렬로 작성한다.
- 문체 통일:
  - `내` 대신 `자신`
  - `하나` 대신 `1 장`
  - 희생 코스트 표기는 `릴리스/릴리즈` 대신 `희생`

### 7-3. 텍스트 길이 압축 규칙

- 카드 효과는 의미를 유지한 상태로 가능한 짧게 표기한다.
- 권장 압축 표기:
  - `체력 N 회복` → `체력+N`
  - `상대 에이전트에게 N 피해` → `피해 N(상대 본체)`
  - `대상 유닛에게 N 피해` → `피해 N(대상 유닛)`
  - 셔플은 기본 처리로 간주하고 카드 텍스트에는 효과 핵심(탐색/징집)만 표기한다.
  - 조건문 `~ 유닛 N기 이상일 때` → `~ N+일 때`
- 타이밍 표기는 `전개 시/사용 시/사용 해결 시`처럼 띄어쓰기를 준수한다.
- 지속/장착/사용 계열도 각 효과 문장 앞에 타이밍(`사용 해결 시 <자동/선택>`)을 명시해 발동 시점을 혼동하지 않게 한다.

---

## 8. 종족 / 테마 / 속성

- 기본 표기: `종족 | 테마 | 속성`
  - 예: `인간족 | 심연 | 어둠`
- 테마 지정은 `[테마]`로 표기한다.
- 카드명 지정은 `"카드 이름"`으로 표기한다.
- 속성 종류:
  - 불, 물, 바람, 땅, 빛, 어둠
- 종족은 `인간족 / 기계족 / 야수족 / 정령족 / 기사족`을 기본 종족으로 사용하고, 비유닛 계열은 `술법`을 사용한다.
- 메인 테마는 `균형 / 기어 / 알케미스타 / 심연` 4종을 사용한다.
- 별도 서브테마 카드군으로 `보급`, `의식`을 운영할 수 있다(메인 4테마 매수와 분리 관리).

---

## 9. 키워드 사전

- 전개: 카드를 존에 배치하며 기본 비용을 지불한다.
- 사용: 메인 페이즈에 수동으로 발동하는 효과다.
- 지속: 필드에 남아있는 동안 영향이 유지된다.
- 자동: 조건을 만족하면 자동 적용된다.
- 탐색: 덱에서 조건에 맞는 카드를 찾아 손패로 가져온다.
- 징집: 덱에서 유닛을 즉시 필드로 전개한다.
- 치유: 유닛 체력을 회복한다.
- 충전: 일시적으로 마나를 획득한다.
- 연쇄: 스택에 올린 뒤 스택 해결 시점에 해결된다.
- 지정: 아군/적군 유닛 중 대상을 정해 적용한다.
- 피해: 유닛 또는 본체에 피해를 준다.
- 장착: 아군 유닛에 부착되어 능력치를 강화한다.
- 수호: 상대 필드에 수호 유닛이 있으면 본체 공격할 수 없다.
- 희생: 아군 유닛을 코스트로 보내 추가 효과를 연다.
- 제외: 대상 유닛을 무덤 대신 제외 영역으로 보낸다.
- 자폭: 자신 유닛을 즉시 파괴한다.

가이드 키워드 목록은 [`vercel/public/js/shared-cards.js`](../vercel/public/js/shared-cards.js)의
`buildKeywordCatalog()`를 기준으로 자동 동기화한다.

---

## 10. 현재 엔진 반영 메모 (구현 동기화)

아래는 현재 `vercel/lib/game.js`, `vercel/public/js/shared-cards.js` 기준의 구현 메모다.

- 카드 정의의 단일 소스(SSOT)는 [`vercel/public/js/shared-cards.js`](../vercel/public/js/shared-cards.js) 이다.
- 현재 테마 카드 풀은 총 45장이다.
  - 균형 5 / 기어 10 / 알케미스타 10 / 심연 10 / 보급 5 / 의식 5

- 존 크기: 유닛 3 / 마법 4
- 드로우/엔드 페이즈는 자동 진행되고, 메인/배틀 중심으로 플레이한다.
- 일반 마법(`spellKind: normal`)은 엔드 페이즈에 정리된다.
- 카드 효과는 `effects[]`(timing / cost / action) 기준으로 처리된다.
- 카드 텍스트(`effect`)는 `effects[]` 기반 자동 생성 문자열을 사용한다.
- 키워드 가이드(`guide.html`)는 카드 정의에서 자동 생성한 키워드를 사용한다.
- 비용이 필요한 효과는 `cost.mana` 검사/차감 후 실행한다.
- 효과 1턴 1회 제한은 `effectUsage`로 관리한다.
- 스택은 `priority_pass` 우선권 루프를 통해 1개씩 해결한다.
- 탐색(search_deck_to_hand), 징집(deploy_from_deck) 처리 후 덱을 다시 셔플한다.
- 액션 키는 AI/엔진 해석을 위해 canonical 영문을 사용한다.
  - `heal_self`, `heal_unit`, `search_deck_to_hand`, `deploy_from_deck`
  - `gain_mana`, `enqueue_stack`, `deal_damage_to_unit`, `deal_damage_to_agent`, `attach_equipment`

---

## 11. 운영 원칙

- 미구현 규칙도 문서에서 유지한다.
- 구현은 이 문서 용어/표기를 우선 기준으로 맞춘다.
- 문서와 코드가 어긋나면, 차이를 `10. 현재 엔진 반영 메모`에 먼저 기록한다.
